# Backlog VSCode ビューワー拡張機能 要件定義

## 概要

VS Code内でBacklogのプロジェクトや課題を
閲覧・管理できる拡張機能を開発する。
MCP（Model Context Protocol）統合により、
AIアシスタントとのシームレスな連携を実現する。

## 機能要件

### 基本機能

#### マルチビューサイドバー表示（Tree View API）

- プロジェクト一覧の表示
- 課題一覧の階層構造表示（プロジェクト別）
- Wiki一覧の表示（プロジェクト別）
- ドキュメント一覧の表示（プロジェクト別）
- 課題のステータス・優先度・担当者による色分け
- プロジェクトフォーカス機能
  （選択したプロジェクトに特化した表示）

#### 詳細画面表示（Webview API）

- 課題詳細情報の表示（エディタタブで開く）
- Wiki詳細情報の表示（エディタタブで開く）
- ドキュメント詳細情報の表示
  （エディタタブで開く）
- Backlog風のリッチなUI
- コメントの表示
- 添付ファイルの表示

#### Webview追跡・管理システム

- 開いている課題Webviewの追跡
- 既存Webviewの自動フォーカス機能
- 重複Webview防止機能
- 既存Webviewの内容自動リフレッシュ

#### Backlog API連携

- 認証情報の安全な管理
  （VS Code Secret Storage）
- プロジェクト情報の取得
- 課題情報の取得
- Wiki情報の取得
- ドキュメント情報の取得
- リアルタイムデータ更新

### 拡張機能

#### 課題操作

- 課題の作成・編集
- コメントの追加
- ステータス変更

#### 検索・フィルタ機能

- プロジェクト検索機能
- 課題の検索
  （キーワード、ステータス、担当者、優先度）
- Wiki検索機能
- ドキュメント検索機能
- 高度なフィルタリング機能
- ソート機能
  （更新日、作成日、優先度、ステータス、概要）

#### キーボードショートカット機能

- **Windows/Linux**: `Alt+Shift+P` / `Alt+Shift+I`
- **macOS**: `Ctrl+Shift+P` / `Ctrl+Shift+I`
- プロジェクトキーでプロジェクトを開く機能
- 課題キーで課題を開く機能
- 入力検証機能
  （プロジェクトキー形式、課題キー形式）
- 存在しないプロジェクト/課題の
  エラーハンドリング
- VS Codeデフォルトキーバインドとの競合回避

#### MCP統合機能

- MCP操作後の課題自動オープン・リフレッシュ
- AIアシスタント連携コマンド
  （`backlog.openIssueAfterMCPOperation`）
- Issues ビューの自動リフレッシュ
- シームレスなワークフロー実現

## 技術要件

### VS Code API

- **Tree View API**:
  マルチビューサイドバーの階層表示
- **Webview API**:
  エディタタブでの詳細画面リッチUI
- **Commands API**:
  コマンドパレット・キーボード
  ショートカット対応
- **Configuration API**: 設定管理
- **Secret Storage API**:
  API キーの安全な保存
- **Context API**:
  プロジェクトフォーカス状態の管理

### MCP統合

- **Model Context Protocol**:
  AIアシスタントとの連携
- **backlog-mcp-server**:
  Backlog API操作のMCPサーバー
- **カスタムコマンド**: MCP操作後の自動処理

### 外部API

- **Backlog REST API v2**:
  プロジェクト、課題、Wiki、
  ドキュメント情報取得
- **認証**: API キー（Secret Storage経由）

### アーキテクチャ

#### Provider パターン: データ提供の責任分離

- `BacklogTreeViewProvider`: プロジェクト表示
- `BacklogIssuesTreeViewProvider`: 課題表示
- `BacklogWikiTreeViewProvider`: Wiki表示
- `BacklogDocumentsTreeViewProvider`:
  ドキュメント表示
- `BacklogWebviewProvider`: 詳細画面表示

#### Service パターン: ビジネスロジックの集約

- `BacklogApiService`: API呼び出し管理
- `ConfigService`: 設定・認証管理

### 開発環境

- **TypeScript**: 型安全な開発
- **VS Code Extension API**: 拡張機能フレームワーク
- **Node.js**: ランタイム環境
- **ESLint + Prettier**: コード品質管理
- **backlog-js**: Backlog API クライアント
  ライブラリ

## 非機能要件

### パフォーマンス

- 課題一覧の読み込み: 3秒以内
- 詳細画面の表示: 1秒以内

### セキュリティ

- API キーの安全な保存
- 通信の暗号化

### ユーザビリティ

- VS Code標準UIとの整合性
- 直感的な操作性

## 制約事項

- Backlog APIの制限に準拠
- VS Code拡張機能の制約に準拠
- オフライン時の制限対応

## 実装状況

### ✅ 実装完了

#### 実装済み: マルチビューサイドバー

- プロジェクト一覧表示
- 課題一覧表示（プロジェクト別）
- Wiki一覧表示（プロジェクト別）
- ドキュメント一覧表示（プロジェクト別）
- プロジェクトフォーカス機能

#### 実装済み: 詳細画面

- 課題詳細Webview（エディタタブ）
- Wiki詳細Webview（エディタタブ）
- ドキュメント詳細Webview（エディタタブ）
- VSCode準拠のリッチUI
- コメント表示機能

#### 実装済み: Webview管理

- 開いている課題Webviewの追跡
- 既存Webviewの自動フォーカス
- 重複Webview防止
- 既存Webviewの内容自動リフレッシュ

#### 実装済み: API連携

- Secret Storage による安全な認証情報管理
- プロジェクト情報取得
- 課題情報取得
- Wiki情報取得
- ドキュメント情報取得
- コメント情報取得

#### 実装済み: 検索・フィルタ

- プロジェクト検索
- 課題検索（キーワード）
- ステータス・優先度・担当者フィルタ
- ソート機能
  （更新日、作成日、優先度、ステータス、概要）

#### 実装済み: キーボードショートカット

- `Ctrl+Shift+P`: プロジェクトキーで
  プロジェクトを開く
- `Ctrl+Shift+I`: 課題キーで課題を開く
- 入力検証機能
- エラーハンドリング

#### 実装済み: MCP統合

- MCP操作後の課題自動オープン・リフレッシュ
- AIアシスタント連携コマンド
- Issues ビューの自動リフレッシュ

### 🔄 未実装・今後の拡張

#### 予定: 課題操作

- 課題の作成・編集
- コメントの追加
- ステータス変更

#### 予定: 高度な検索

- 複合条件検索
- 保存された検索条件
- 検索履歴

#### 予定: 通知・リアルタイム更新

- 課題更新通知
- 自動リフレッシュ機能

#### 予定: オフライン対応

- キャッシュ機能
- オフライン時の表示

## 成功基準

1. ✅ プロジェクト・課題一覧の正常表示
2. ✅ 課題詳細の完全表示
3. 🔄 基本的な課題操作の実行
4. ✅ 設定の永続化
5. ✅ 複数プロジェクトの対応
6. ✅ MCP統合によるAIアシスタント連携
7. ✅ キーボードショートカット対応
